// @ts-nocheck
document.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("form"),t=(localStorage.getItem("maziEmail")||"").toLowerCase().trim();if(!t)return void(window.location.href="singin.html");const a="savedAddresses_v1",n=a+"_"+t,r=a;function o(e){try{return JSON.parse(e||"[]")}catch(e){return[]}}e.addEventListener("submit",(function(e){e.preventDefault();const t=(document.getElementById("address-label")?.value||"").trim()||"Other",a=(document.getElementById("recipient-name")?.value||"").trim(),l=(document.getElementById("phone-number")?.value||"").trim(),i=(document.getElementById("street-address")?.value||"").trim(),c=(document.getElementById("city")?.value||"").trim(),m=(document.getElementById("province")?.value||"").trim(),s=(document.getElementById("postal-code")?.value||"").trim(),d=document.getElementById("default-address");let u=!(!d||!d.checked);if(!a||!l||!i)return void alert("Isi Nama, No. Telepon, dan Alamat jalan minimal.");const g=`${i}\n${c}${c&&m?", ":""}${m}\n${s}`,h=function(){let e=o(localStorage.getItem(n));if(Array.isArray(e)&&e.length)return e;const t=o(localStorage.getItem(r));if(Array.isArray(t)&&t.length){try{localStorage.setItem(n,JSON.stringify(t)),localStorage.removeItem(r)}catch(e){console.warn("Failed migrating legacy addresses",e)}return t}return[]}();if(h.length>=5)return void alert("Maksimum 5 alamat saja. Hapus salah satu jika ingin menambah lagi.");0===h.length&&(u=!0);const f={label:t,name:a,phone:l,address:g,isDefault:!!u};f.isDefault&&h.forEach((e=>{e.isDefault=!1})),h.push(f),function(e){try{localStorage.setItem(n,JSON.stringify(e||[]))}catch(e){console.error("Failed to write addresses to localStorage",e)}}(h);const y=`${a}\n${l}\n${g}`,v=new URLSearchParams(window.location.search).get("from"),I="signup"===v;if("checkout"===v){try{localStorage.setItem("checkoutRecipientDraft_v1",y)}catch(e){}window.location.href="cekout.html"}else window.location.href=I?"Home.html":"drafamt.html"}))}));