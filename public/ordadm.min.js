// @ts-nocheck
!function(){"use strict";function t(t){return"Rp "+new Intl.NumberFormat("id-ID").format(Number(t||0))}function e(t){return String(t||"").replace(/[&<>"']/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])))}function a(){const t=[];for(let e=0;e<localStorage.length;e++){const a=localStorage.key(e);if(!a||!a.startsWith("orders_"))continue;const n=a.slice(7)||"guest";let i;try{i=JSON.parse(localStorage.getItem(a)||"[]")}catch(t){i=[]}Array.isArray(i)&&i.forEach((e=>{e&&(e.userId||(e.userId=n),t.push(e))}))}return t}function n(t){const e=t.userId||"guest",a="orders_"+e;let n;try{n=JSON.parse(localStorage.getItem(a)||"[]")}catch(t){n=[]}Array.isArray(n)||(n=[]);const i=n.findIndex((e=>String(e.id)===String(t.id)));-1!==i?n[i]=t:n.unshift(t);try{localStorage.setItem(a,JSON.stringify(n))}catch(t){console.error("Failed to save order bucket for user",e,t)}}function i(t){const e="savedAddresses_v1_"+(t||"guest");let a=[];try{a=JSON.parse(localStorage.getItem(e)||"[]"),Array.isArray(a)||(a=[])}catch(t){a=[]}return a.length||(a=function(t,e){try{return JSON.parse(localStorage.getItem(t)||(e??"[]"))}catch(t){return e?JSON.parse(e):[]}}("savedAddresses_v1","[]")),a}function s(t,e){const a=t.userId||"guest",n="notifications_v1_"+a;let i;try{i=JSON.parse(localStorage.getItem(n)||"[]")}catch(t){i=[]}Array.isArray(i)||(i=[]);const s=new Date;let d="",r="",l="";"approved"===e?(d="Payment Confirmed",l="üí∏",r="Order "+(t.id||"")+" telah dikonfirmasi dan pembayaran sudah diterima admin."):"rejected"===e&&(d="Order Rejected",l="‚õî",r="Order "+(t.id||"")+" telah ditolak / dibatalkan oleh admin.");const o={id:"adm-"+e+"-"+(t.id||"")+"-"+s.getTime(),title:d,message:r,emoji:l,time:"Just now",isRead:!1};i.unshift(o);try{localStorage.setItem(n,JSON.stringify(i))}catch(t){console.error("Failed to save notifications for user",a,t)}}let d="all";function r(){const l=document.getElementById("order-list");if(!l)return;l.innerHTML="";let o=a();o=o.filter((t=>"cancelled"!==String(t.status||"").toLowerCase())),"history"===d?o=o.filter((t=>"completed"===String(t.status||"").toLowerCase())):(o=o.filter((t=>"completed"!==String(t.status||"").toLowerCase())),"gift"===d&&(o=o.filter((t=>!!t.isGift&&!!t.gift)))),o.length?o.forEach((d=>{l.appendChild(function(d){const l=document.createElement("article");l.className="admin-order-card";const o=new Date(d.createdAt||Date.now()).toLocaleString(),c=(d.status||"active").toLowerCase(),m=(d.paymentStatus||"pending").toLowerCase();"completed"===c?l.classList.add("is-completed"):"paid"===m&&l.classList.add("is-paid");const u=!!d.isGift&&!!d.gift;u&&l.classList.add("gift");let g="";if(d.scheduledAt)try{g=new Date(d.scheduledAt).toLocaleString("id-ID")}catch(t){}const v=d.items&&d.items[0]?d.items[0]:null,p=v?v.title||v.name||"":"(no items)",f=d.meta&&"string"==typeof d.meta.recipient?d.meta.recipient.trim():"",y=i(d.userId);let b=null;Array.isArray(y)&&y.length&&(b=y.find((t=>t&&t.isDefault))||y[0]);let h="";if(f){h=`\n        <div class="admin-address">\n          <div class="admin-address-title">Recipient</div>\n          <div class="admin-address-main">\n            <div>${e(f).replace(/\n/g,"<br>")}</div>\n          </div>\n        </div>\n      `}else if(b){const t=e(b.label||""),a=e(b.name||""),n=e(b.phone||"");h=`\n        <div class="admin-address">\n          <div class="admin-address-title">Address</div>\n          <div class="admin-address-main">\n            <div>${`${t||""}${t&&a?" - ":""}${a||""}`}</div>\n            ${n?`<div>${n}</div>`:""}\n            <div>${e(b.address||"").replace(/\n/g,"<br>")}</div>\n          </div>\n        </div>\n      `}let S="";if(u){const t="surprise"===String(d.gift.revealMode||"reveal")?"Keep it a surprise":"Reveal it now";S=`\n        <div class="admin-gift-block">\n          <div class="admin-gift-title">üéÅ Gift order</div>\n          ${d.gift.message?`<div class="admin-gift-line"><strong>Message:</strong> ${e(d.gift.message)}</div>`:""}\n          ${d.gift.fromName?`<div class="admin-gift-line"><strong>From:</strong> ${e(d.gift.fromName)}</div>`:""}\n          <div class="admin-gift-line"><strong>Reveal:</strong> ${e(t)}</div>\n          ${g?`<div class="admin-gift-line"><strong>Schedule:</strong> ${e(g)}</div>`:""}\n        </div>\n      `}let $="";(d.items||[]).forEach((a=>{if(!a)return;const n=e(a.title||a.name||""),i=a.addons&&a.addons.length?'<div class="admin-item-addons">'+a.addons.map((t=>e(t.label||""))).join(", ")+"</div>":"",s=Number(a.qty||0),d=Number(a.unitPrice||a.price||0),r=Number(a.subtotal||d*s),l=s+" √ó "+t(d)+" = "+t(r);$+=`\n        <div class="admin-item-row">\n          <div class="admin-item-main">\n            <div class="admin-item-title">${n}</div>\n            ${i}\n            <div class="admin-item-price">${e(l)}</div>\n          </div>\n        </div>\n      `}));const L="paid"===m?"badge-payment paid":"rejected"===m?"badge-payment rejected":"badge-payment";l.innerHTML=`\n      <div class="admin-order-header">\n        <div>\n          <div class="admin-order-id">Order ID: ${e(d.id||"(no id)")}</div>\n          <div class="admin-order-created">${e(o)}</div>\n        </div>\n        <div class="admin-order-total">\n          <span class="admin-total-label">Total</span>\n          <span class="admin-total-value">${t(d.total)}</span>\n        </div>\n      </div>\n\n      <div class="admin-status-row">\n        <span class="badge badge-status">${e(c)}</span>\n        <span class="badge ${L}">${e(m)}</span>\n      </div>\n\n      <div class="admin-summary-row">\n        <span class="summary-chip">${u?"üéÅ Gift":"Order"}</span>\n        <span class="summary-main">${e(p)}</span>\n        ${g&&u?`<span class="summary-schedule"> ¬∑ ${e(g)}</span>`:""}\n        <button type="button" class="btn-toggle-detail" aria-expanded="false">\n          Detail\n        </button>\n      </div>\n\n      <div class="admin-details">\n        ${S}\n        <div class="admin-items">\n          ${$}\n        </div>\n        ${h}\n        <div class="admin-actions">\n          <button class="btn btn-approve" data-id="${e(d.id)}">ACC (sudah dibayar)</button>\n          <button class="btn btn-reject" data-id="${e(d.id)}">Tolak order</button>\n          <button class="btn btn-delivered" data-id="${e(d.id)}">Mark as delivered</button>\n        </div>\n      </div>\n    `;const A=l.querySelector(".btn-approve"),I=l.querySelector(".btn-reject"),w=l.querySelector(".btn-delivered"),O=l.querySelector(".admin-details"),k=l.querySelector(".btn-toggle-detail");O&&(window.innerWidth<600?(O.classList.add("collapsed"),k&&(k.setAttribute("aria-expanded","false"),k.textContent="Detail")):(O.classList.remove("collapsed"),k&&(k.setAttribute("aria-expanded","true"),k.textContent="Sembunyikan")));k&&O&&k.addEventListener("click",(function(t){t.stopPropagation();const e=O.classList.toggle("collapsed");this.setAttribute("aria-expanded",String(!e)),this.textContent=e?"Detail":"Sembunyikan"}));"completed"===c||"cancelled"===c?(A&&(A.style.display="none"),I&&(I.style.display="none"),w&&(w.style.display="none")):"paid"===m?(A&&(A.style.display="none"),I&&(I.style.display="none")):w&&(w.style.display="none");A&&A.addEventListener("click",(function(t){t.stopPropagation();const e=this.dataset.id,i=a().find((t=>String(t.id)===String(e)));i&&(i.paymentStatus="paid",i.status||(i.status="active"),n(i),s(i,"approved"),r(),alert("Order di-set sebagai SUDAH DIBAYAR."))}));I&&I.addEventListener("click",(function(t){t.stopPropagation();const e=this.dataset.id,i=a().find((t=>String(t.id)===String(e)));i&&(i.paymentStatus="rejected",i.status="cancelled",n(i),s(i,"rejected"),r(),alert("Order telah DITOLAK / dibatalkan oleh admin."))}));w&&w.addEventListener("click",(function(t){t.stopPropagation();const e=this.dataset.id,i=a().find((t=>String(t.id)===String(e)));if(i){if("paid"!==String(i.paymentStatus||"").toLowerCase())return void alert("Order harus sudah dibayar sebelum ditandai sebagai delivered.");i.status="completed",n(i),r(),alert("Order ditandai sebagai DELIVERED dan pindah ke History.")}}));return l.addEventListener("click",(function(t){if(t.target.closest(".admin-actions")||t.target.closest(".btn-toggle-detail"))return;if("paid"!==m)return;const e=d.id||"";e&&(window.location.href="diteladm.html?id="+encodeURIComponent(e))})),l}(d))})):l.innerHTML='<div style="color:#777;font-size:13px;">Belum ada order.</div>'}document.addEventListener("DOMContentLoaded",(function(){const t=document.querySelectorAll(".admin-pill");t.length&&t.forEach((e=>{e.addEventListener("click",(()=>{const a=e.dataset.filter||"all";d=a,t.forEach((t=>t.classList.remove("is-active"))),e.classList.add("is-active"),r()}))})),r()}))}();