// @ts-nocheck
!function(){"use strict";function t(t){return`${t}_${localStorage.getItem("maziUID")||"guest"}`}function e(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let e="";for(let r=0;r<5;r++)e+=t[Math.floor(52*Math.random())];let r="";for(let t=0;t<4;t++)r+=Math.floor(10*Math.random());return e+r}function r(){try{const e=t("cart");return JSON.parse(localStorage.getItem(e)||"[]")}catch(t){return[]}}document.addEventListener("click",(async function(a){if(!(a.target.closest&&a.target.closest(".checkout")))return;a.preventDefault();const n=function(){const t=r();if(!t.length)return null;let a=0;const n=t.map((t=>{const e=Number(t.unitPrice||t.price||0),r=Number(t.qty||1),n=Number(t.subtotal||e*r||e*r);return a+=n,{id:t.id,title:t.title,qty:r,unitPrice:e,subtotal:n,addons:t.addons||[],image:t.image||t.images&&t.images[0]||""}}));return{id:e(),createdAt:Date.now(),status:"active",paymentStatus:"pending",total:a,items:n}}();if(!n)return void alert("Keranjang kosong. Tambahkan item dulu sebelum checkout.");const o=localStorage.getItem("maziUID")||null,i=localStorage.getItem("maziEmail")||"",s=localStorage.getItem("maziName")||"";n.userId=o,n.userEmail=i,n.userName=s;try{const t=window.supabase;if(t){const{data:e,error:r}=await t.auth.getUser();if(!r&&e?.user){const r=e.user,{data:a,error:o}=await t.from("orders").insert({user_id:r.id,client_order_id:n.id,status:"active",is_gift:!1,scheduled_at:null,total:n.total,shipping_fee:0,payment_status:n.paymentStatus,delivery_method:null,notes:null,recipient_name:null,recipient_phone:null,recipient_address:null}).select("id").single();if(o)console.warn("Supabase orders insert error (bagfr):",o);else if(a){const e=n.items.map((t=>({order_id:a.id,product_id:t.id?String(t.id):null,title:t.title,qty:t.qty,unit_price:t.unitPrice,subtotal:t.subtotal,image_url:t.image||null,addons_json:t.addons&&t.addons.length?t.addons:null}))),{error:r}=await t.from("order_items").insert(e);r&&console.warn("Supabase order_items insert error (bagfr):",r)}}else console.warn("Supabase getUser error / no user (bagfr), skip remote order save",r)}}catch(t){console.warn("Unexpected Supabase error during bag checkout:",t)}const l=function(){try{const e=t("orders");return JSON.parse(localStorage.getItem(e)||"[]")}catch(t){return[]}}();l.unshift(n),function(e){try{const r=t("orders");localStorage.setItem(r,JSON.stringify(e||[]))}catch(t){}}(l);const c=t("cart");localStorage.removeItem(c),"function"==typeof window.renderCart&&window.renderCart();const u=`Halo mimin Mazi, tolong cek ongkir untuk pesanan ku dengan ID ${n.id}.`,d=`https://wa.me/628118281416?text=${encodeURIComponent(u)}`;window.open(d,"_blank"),window.location.href="./order.html?order="+encodeURIComponent(n.id)})),document.addEventListener("click",(function(t){const e=t.target.closest&&t.target.closest(".gift-toggle");if(!e)return;if(!r().length){try{e.animate([{transform:"scale(1)"},{transform:"scale(1.04)"},{transform:"scale(1)"}],{duration:180})}catch(t){}return void alert("Tambahkan dulu minimal 1 item ke Bag sebelum menjadikan pesanan sebagai hadiah üíù")}const a="true"===e.getAttribute("aria-pressed");e.setAttribute("aria-pressed",a?"false":"true");try{e.animate([{transform:"scale(1)"},{transform:"scale(1.06)"},{transform:"scale(1)"}],{duration:180})}catch(t){}window.location.href="gif.html"}))}();