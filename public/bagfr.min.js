// @ts-nocheck
!function(){"use strict";function t(t){return"Rp "+(t=Math.round(Number(t)||0)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,".")}function e(t){return String(t||"").replace(/[&<>"']/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[t])))}function r(t){return`${t}_${localStorage.getItem("maziUID")||"guest"}`}function n(){try{const t=r("cart");return JSON.parse(localStorage.getItem(t)||"[]")}catch(t){return[]}}function i(t){const e=r("cart");localStorage.setItem(e,JSON.stringify(t||[]))}function a(){const r=n(),i=document.getElementById("bag-items")||document.querySelector(".cart-list")||document.querySelector(".bag-items");if(!i)return;if(i.innerHTML="",!r.length)return i.innerHTML='\n        <div class="empty-bag">\n          <img src="acs/bag1.png" alt="Keranjang kosong">\n        </div>\n      ',void s();let a=0;r.forEach(((r,n)=>{const s=Number(r.unitPrice||r.price||0),o=Number(r.qty||1),l=Number(r.subtotal||s*o||s*o);a+=l;const d=r.addons&&r.addons.length?r.addons.map((r=>{const n=String(r.label||"").trim(),i=/\(\s*\+\s*\d+|Rp\b|K\)/i.test(n),a=e(n);return i?`<div class="addon">${a}</div>`:`<div class="addon">${a}${r.price?` (+${t(r.price)})`:""}</div>`})).join(""):"",c=`\n        <article class="cart-item" data-idx="${n}" data-price="${s}">\n          <div class="thumb">\n            <img src="${e(r.image||r.images&&r.images[0]||"assets/placeholder.png")}" alt="${e(r.title||"Product")}"\n                 onerror="this.onerror=null;this.src='assets/placeholder.png'">\n          </div>\n          <div class="item-body">\n            <div class="item-head">\n              <div>\n                <div class="item-title">${e(r.title||"Untitled")}</div>\n                <div class="item-meta">${d}</div>\n              </div>\n              <button class="remove" title="Hapus item" aria-label="Hapus item" data-idx="${n}">\n                <img src="acs/smph.png" alt="Hapus">\n              </button>\n            </div>\n\n            <div class="item-controls">\n              <div class="qty-control">\n                <button class="qty-btn qty-decr" aria-label="Kurangi">-</button>\n                <span class="qty">${o}</span>\n                <button class="qty-btn qty-incr" aria-label="Tambah">+</button>\n              </div>\n\n              <div class="right-col">\n                <div class="item-sub-value">${t(l)}</div>\n              </div>\n            </div>\n          </div>\n        </article>\n      `,u=document.createElement("div");u.innerHTML=c.trim(),i.appendChild(u.firstElementChild)})),s(a)}function s(e){let r=Number(e||0);if(!e){r=n().reduce(((t,e)=>t+(Number(e.subtotal)||Number(e.unitPrice||e.price||0)*Number(e.qty||1))),0)}const i=document.querySelector(".summary-value")||document.getElementById("bag-total")||document.querySelector(".bag-total");i&&(i.textContent=t(r))}function o(){return"likes_"+(localStorage.getItem("maziUID")||"guest")}function l(){try{return JSON.parse(localStorage.getItem(o())||"[]")}catch(t){return[]}}function d(){const t=l(),r=document.querySelector(".liked-row")||document.getElementById("liked-row");r&&(r.innerHTML="",t.length?t.forEach((t=>{const n=String(t.id||""),i=String(t.title||""),a=String(t.image||"assets/placeholder.png"),s=Number(t.price||0),o=s?"Rp "+new Intl.NumberFormat("id-ID").format(s):"",l=document.createElement("article");l.className="like-card",l.setAttribute("role","listitem"),l.setAttribute("data-id",n),l.setAttribute("data-source",t.source||(n.includes("dsri-")?"dsri":n.includes("drsi-")?"drsi":"")),l.innerHTML=`\n        <div class="like-thumb">\n          <img src="${e(a)}" alt="${e(i)}"\n               onerror="this.onerror=null;this.src='assets/placeholder.png'">\n        </div>\n\n        <div class="like-body">\n          <div class="like-title">${e(i)}</div>\n        </div>\n\n        <div class="like-footer">\n          ${o?`<div class="like-price footer-price">${e(o)}</div>`:""}\n          <button class="like-heart" aria-label="Unlike" title="Unlike"\n                  data-id="${e(n)}" aria-pressed="false">‚ù§</button>\n        </div>\n      `,r.appendChild(l)})):r.innerHTML='<div style="color:#888;padding:12px">You have no liked items yet.</div>')}document.addEventListener("click",(function(t){const e=t.target.closest(".cart-item");if(!e)return;const r=Number(e.dataset.idx);let s=n();return t.target.closest(".qty-incr")?(s[r].qty=Number(s[r].qty||1)+1,s[r].subtotal=Number(s[r].unitPrice||s[r].price||0)*s[r].qty,i(s),void a()):t.target.closest(".qty-decr")?(s[r].qty=Math.max(1,Number(s[r].qty||1)-1),s[r].subtotal=Number(s[r].unitPrice||s[r].price||0)*s[r].qty,i(s),void a()):t.target.closest(".remove")?(s.splice(r,1),i(s),void a()):void 0})),window.addToBag=function(t){if(!t||!t.id)throw new Error("productObj.id required");const e=n(),r=e.findIndex((e=>e.id===t.id&&JSON.stringify(e.addons||[])===JSON.stringify(t.addons||[])));if(r>=0)e[r].qty=Number(e[r].qty||1)+(Number(t.qty)||1),e[r].subtotal=Number(e[r].unitPrice||e[r].price||0)*e[r].qty;else{const r=Number(t.qty||1),n=Number(t.unitPrice||t.price||0),i={id:t.id,title:t.title||"",unitPrice:n,qty:r,subtotal:Number(t.subtotal||n*r),image:t.image||t.images&&t.images[0]||"assets/placeholder.png",addons:t.addons||[],source:t.source||""};e.push(i)}i(e),a()},window.renderCart=a,document.addEventListener("click",(function(t){const e=t.target.closest(".like-heart");if(e){e.setAttribute("aria-pressed","true"),e.classList.add("like-heart-pressed");const r=e.dataset.id;return r?setTimeout((()=>{let t=l();var e;t=t.filter((t=>String(t.id)!==String(r))),e=t,localStorage.setItem(o(),JSON.stringify(e||[])),d(),window.dispatchEvent(new CustomEvent("likes:updated",{detail:{likes:t}}))}),180):setTimeout(d,180),void t.stopPropagation()}const r=t.target.closest(".like-card");if(r){let t=r.getAttribute("data-id")||r.dataset.id||null;const e=(r.getAttribute("data-source")||r.dataset.source||"").toLowerCase().trim()||null;if(!t)try{const e=l(),n=r.querySelector(".like-title")?.textContent?.trim()||"",i=r.querySelector(".like-thumb img")?.src,a=e.find((t=>t.title&&t.title===n||t.image&&t.image===i));a&&a.id&&(t=a.id)}catch(t){}if(!t)return void alert("Tidak dapat menemukan id produk untuk kartu ini.");let n="./drsi.html";"dsri"===e?n="./dsri.html":"bsri"===e?n="./bsri.html":t.startsWith("dsri-")?n="./dsri.html":t.startsWith("drsi-")&&(n="./drsi.html"),window.location.assign(`${n}?id=${encodeURIComponent(String(t))}`)}})),document.addEventListener("DOMContentLoaded",(function(){a(),d()})),window.addEventListener("likes:updated",d)}(),function(){"use strict";function t(t){return`${t}_${localStorage.getItem("maziUID")||"guest"}`}function e(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";let e="";for(let r=0;r<5;r++)e+=t[Math.floor(52*Math.random())];let r="";for(let t=0;t<4;t++)r+=Math.floor(10*Math.random());return e+r}function r(){try{const e=t("cart");return JSON.parse(localStorage.getItem(e)||"[]")}catch(t){return[]}}document.addEventListener("click",(async function(n){if(!(n.target.closest&&n.target.closest(".checkout")))return;n.preventDefault();const i=function(){const t=r();if(!t.length)return null;let n=0;const i=t.map((t=>{const e=Number(t.unitPrice||t.price||0),r=Number(t.qty||1),i=Number(t.subtotal||e*r||e*r);return n+=i,{id:t.id,title:t.title,qty:r,unitPrice:e,subtotal:i,addons:t.addons||[],image:t.image||t.images&&t.images[0]||""}}));return{id:e(),createdAt:Date.now(),status:"active",paymentStatus:"pending",total:n,items:i}}();if(!i)return void alert("Keranjang kosong. Tambahkan item dulu sebelum checkout.");const a=localStorage.getItem("maziUID")||null,s=localStorage.getItem("maziEmail")||"",o=localStorage.getItem("maziName")||"";if(i.userId=a,i.userEmail=s,i.userName=o,supabase)try{const t=window.supabase;if(t){const{data:e,error:r}=await t.auth.getUser(),{data:n,error:a}=await t.from("orders").insert({user_id:supaUser.id,client_order_id:i.id,status:"active",is_gift:!1,scheduled_at:null,total:i.total,shipping_fee:0,payment_status:i.paymentStatus,delivery_method:null,notes:null,recipient_name:null,recipient_phone:null,recipient_address:null}).select("id").single();if(a)console.warn("Supabase orders insert error (bagfr):",a);else if(n){const e=i.items.map((t=>({order_id:n.id,product_id:t.id?String(t.id):null,title:t.title,qty:t.qty,unit_price:t.unitPrice,subtotal:t.subtotal,image_url:t.image||null,addons_json:t.addons&&t.addons.length?t.addons:null}))),{error:r}=await t.from("order_items").insert(e);r&&console.warn("Supabase order_items insert error (bagfr):",r)}}else console.warn("Supabase getUser error / no user (bagfr), skip remote order save",userErr)}catch(t){console.warn("Unexpected Supabase error during bag checkout:",t)}const l=function(){try{const e=t("orders");return JSON.parse(localStorage.getItem(e)||"[]")}catch(t){return[]}}();l.unshift(i),function(e){try{const r=t("orders");localStorage.setItem(r,JSON.stringify(e||[]))}catch(t){}}(l);const d=t("cart");localStorage.removeItem(d),"function"==typeof window.renderCart&&window.renderCart();const c=`Halo mimin Mazi, tolong cek ongkir untuk pesanan ku dengan ID ${i.id}.`,u=`https://wa.me/628118281416?text=${encodeURIComponent(c)}`;window.open(u,"_blank"),window.location.href="./order.html?order="+encodeURIComponent(i.id)})),document.addEventListener("click",(function(t){const e=t.target.closest&&t.target.closest(".gift-toggle");if(!e)return;if(!r().length){try{e.animate([{transform:"scale(1)"},{transform:"scale(1.04)"},{transform:"scale(1)"}],{duration:180})}catch(t){}return void alert("Tambahkan dulu minimal 1 item ke Bag sebelum menjadikan pesanan sebagai hadiah üíù")}const n="true"===e.getAttribute("aria-pressed");e.setAttribute("aria-pressed",n?"false":"true");try{e.animate([{transform:"scale(1)"},{transform:"scale(1.06)"},{transform:"scale(1)"}],{duration:180})}catch(t){}window.location.href="gif.html"}))}();