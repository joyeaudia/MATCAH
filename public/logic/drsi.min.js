// @ts-nocheck
!async function(){"use strict";const t=t=>document.querySelector(t),e=t=>"Rp "+new Intl.NumberFormat("id-ID").format(Number(t)||0),r=t=>Number(String(t||"").replace(/[^\d]/g,""))||0,a=t=>`${t}_${localStorage.getItem("maziUID")||"guest"}`;try{const r=new URLSearchParams(location.search).get("id"),a="drsi";if(r){const o=(await async function(){const t=["drsi.json","dsri.json","products.json","/drsi.json","/products.json","/dsri.json"];for(const e of t)try{const t=await fetch(e,{cache:"no-store"});if(!t.ok)continue;const r=await t.json();if(Array.isArray(r))return r}catch(t){}throw new Error("products file not found (drsi.json/products.json)")}()||[]).map((t=>{const e=String(t.id||t._id||t.code||""),r=e&&!e.startsWith(a+"-")?`${a}-${e}`:e;return{...t,id:r,source:a}})),n=r&&!r.startsWith(a+"-")?`${a}-${r}`:r,i=o.find((t=>t.id===n));i?function(r){const a=t(".product-name"),o=t(".product-subtitle"),n=t("#product-price"),i=t(".product-image"),c=t("#detail-desc"),s=t("#quantity");a&&(a.textContent=r.title||"",a.dataset.id=r.id||"",a.dataset.source=r.source||"drsi"),o&&(o.textContent=r.subtitle||"");const d=Number(r.price||0);if(window.productBasePrice=d,n&&(n.dataset.base=d,n.textContent=e(d),n.setAttribute("aria-live","polite")),i){const t=r.images&&r.images[0]||"",e=r.title||"";i.tagName&&"img"===i.tagName.toLowerCase()?(i.src=t,i.alt=e):i.innerHTML=`<img src="${t}" alt="${e}" />`}c&&(Array.isArray(r.description)?c.innerHTML=r.description.join("<br><br>"):c.innerHTML=r.description||""),s&&(!s.value||Number(s.value)<=0)&&(s.value=1)}(i):console.error("Product not found for id:",r)}else console.error("No product id in URL (?id=...)")}catch(t){console.error("Error loading product:",t)}!function(){const a=t("#product-price");function o(t){const e=t.dataset.price??t.dataset.priceDelta??t.getAttribute("data-price-delta")??t.getAttribute("data-price");return r(e)}function n(){let t=r(a?.dataset.base||window.productBasePrice||0);const n=document.querySelector('.option-group[data-key="milk"] button[aria-pressed="true"]');n&&(t+=o(n)),document.querySelectorAll('.option-group[data-key="addons"] button[aria-pressed="true"]').forEach((e=>{t+=o(e)})),a&&(a.textContent=e(t));const i=document.getElementById("price-display");i&&(i.textContent=e(t))}document.querySelectorAll(".option-group").forEach((t=>{const e=Array.from(t.querySelectorAll("button")),r="addons"===t.dataset.key;e.forEach((t=>{t.hasAttribute("aria-pressed")||t.setAttribute("aria-pressed","false"),t.addEventListener("click",(()=>{if(r){const e="true"===t.getAttribute("aria-pressed");t.setAttribute("aria-pressed",(!e).toString())}else e.forEach((t=>t.setAttribute("aria-pressed","false"))),t.setAttribute("aria-pressed","true");n()})),t.addEventListener("keydown",(e=>{"Enter"!==e.key&&" "!==e.key&&"Spacebar"!==e.key||(e.preventDefault(),t.click())}))}))})),window.updatePriceFromUI=n,setTimeout(n,40)}(),function(){const t=document.querySelector(".heart");if(!t)return;const e=()=>"likes_"+(localStorage.getItem("maziUID")||"guest");function r(t){localStorage.setItem(e(),JSON.stringify(t||[]))}function a(t){let e=document.querySelector(".mini-toast");e||(e=document.createElement("div"),e.className="mini-toast",Object.assign(e.style,{position:"fixed",left:"50%",transform:"translateX(-50%)",bottom:"28px",background:"#111",color:"#fff",padding:"8px 12px",borderRadius:"8px",zIndex:1600,opacity:0,transition:"opacity .18s"}),document.body.appendChild(e)),e.textContent=t,e.style.opacity="1",setTimeout((()=>e.style.opacity="0"),1300)}t.addEventListener("click",(function(o){o.preventDefault();const n="true"===t.getAttribute("aria-pressed");t.setAttribute("aria-pressed",String(!n));try{t.animate([{transform:"scale(1)"},{transform:"scale(1.12)"},{transform:"scale(1)"}],{duration:220})}catch(o){}let i=function(){try{return JSON.parse(localStorage.getItem(e())||"[]")}catch(t){return[]}}();const c=function(){const t=document.querySelector(".product-name")?.dataset?.id||new URLSearchParams(location.search).get("id")||"",e="drsi",r=t&&!String(t).startsWith(e+"-")?e+"-"+t:String(t),a=document.querySelector(".product-name")?.textContent?.trim()||document.title||"";let o=document.querySelector(".product-image img")||document.querySelector(".product-image")||null,n="";if(o)if(o.tagName&&"img"===o.tagName.toLowerCase())n=o.src||o.getAttribute("src")||"";else if(o.querySelector){const t=o.querySelector("img");t&&(n=t.src||t.getAttribute("src")||"")}try{n&&(n=new URL(n,location.href).href)}catch(t){}return{id:r,source:e,title:a,image:n||"",price:Number(document.getElementById("product-price")?.dataset?.base||0)}}();if(!c.id)return void a("Tidak dapat menyukai item ini");const s=i.findIndex((t=>String(t.id)===String(c.id)));n?(s>-1&&i.splice(s,1),r(i),a("Dihapus dari Liked")):(-1===s&&i.unshift(c),r(i),a("Ditambahkan ke Liked")),window.dispatchEvent(new CustomEvent("likes:updated",{detail:{likes:i}}))}))}(),function(){const e=t=>Number(String(t||0).replace(/[^\d]/g,""))||0;function r(){const t=[];var r;(r='.option-group button[aria-pressed="true"]',Array.from(document.querySelectorAll(r))).forEach((r=>{const a=r.dataset.choiceId||r.dataset.id||r.getAttribute("data-id")||r.textContent.trim(),o=r.dataset.label||r.textContent.trim(),n=e(r.dataset.price??r.dataset.priceDelta??r.getAttribute("data-price-delta"));t.push({id:String(a).replace(/_/g,"-"),label:o.trim(),price:n})}));const a=document.getElementById("product-options");return a&&(a.querySelectorAll("input").forEach((r=>{if(!r.disabled&&("checkbox"===r.type&&r.checked||"radio"===r.type&&r.checked)){const o=r.dataset.choiceId||r.id||r.name+"_"+r.value,n=r.dataset.label||a.querySelector(`label[for="${r.id}"]`)?.textContent?.trim()||o,i=e(r.dataset.price||r.getAttribute("data-price")||0);t.push({id:String(o).replace(/_/g,"-"),label:n.trim(),price:i})}})),a.querySelectorAll("select").forEach((r=>{const a=r.options[r.selectedIndex];if(a&&!a.disabled){const o=e(a.dataset.price||a.getAttribute("data-price")||0);t.push({id:(r.name||r.id)+"_"+(a.value||a.text),label:a.text||a.value,price:o})}}))),t}function o(o=!0){const n=t(".product-name"),i=n?.dataset?.id||new URLSearchParams(location.search).get("id"),c=n?.dataset?.source||"drsi",s=i&&!i.startsWith(c+"-")?`${c}-${i}`:i,d=(n?.textContent||t(".product-title")?.textContent||"").trim(),u=e(t("#product-price")?.dataset?.base||t("#product-price")?.textContent),l=Number(t("#quantity")?.value||1);if(!s)return console.warn("no product id"),!1;const p=r(),m=function(t,e,r){const a=(r||[]).reduce(((t,e)=>t+Number(e.price||0)),0),o=Number(t||0)+a;return{unit:o,subtotal:o*Math.max(1,Number(e||1)),addTotal:a}}(u,l,p),g=t(".product-image"),f=g&&g.tagName&&"img"===g.tagName.toLowerCase()?g.src:t(".product-image img")?.src||"",b={id:String(s),source:c,title:d,unitPrice:Number(m.unit||0),qty:Number(l||1),addons:Array.isArray(p)?p:[],subtotal:Number(m.subtotal||0),image:f||""};let h=function(){try{const t=a("cart");return JSON.parse(localStorage.getItem(t)||"[]")}catch(t){return[]}}();return h=function(t,e){const r=t=>(t.addons||[]).map((t=>t.id)).sort().join("|"),a=r(e);for(let o=0;o<t.length;o++)if(t[o].id===e.id&&r(t[o])===a)return t[o].qty=Number(t[o].qty||1)+Number(e.qty||1),t[o].subtotal=Number(t[o].subtotal||0)+Number(e.subtotal||0),t;return t.push(e),t}(h,b),function(t){const e=a("cart");localStorage.setItem(e,JSON.stringify(t||[]))}(h),function(t="Added to bag"){let e=document.querySelector(".mini-toast");e||(e=document.createElement("div"),e.className="mini-toast",e.style.cssText="position:fixed;left:50%;transform:translateX(-50%);bottom:28px;background:#111;color:#fff;padding:8px 12px;border-radius:8px;z-index:1600;opacity:0;transition:opacity .18s",document.body.appendChild(e)),e.textContent=t,e.style.opacity="1",setTimeout((()=>e.style.opacity="0"),1200)}("Item added to bag"),o&&setTimeout((()=>window.location.href="bagfr.html"),450),!0}document.addEventListener("click",(t=>{const e=t.target.closest&&t.target.closest(".add-btn, [data-add-to-bag]");if(!e)return;t.preventDefault();o(!e.hasAttribute("data-no-redirect"))})),window.addToBagFromPage=o,window.addToBag=o}(),function(){const t=t=>"Rp "+new Intl.NumberFormat("id-ID").format(Number(t||0));document.addEventListener("click",(e=>{if(!e.target.closest)return;if(!e.target.closest(".checkout, [data-checkout]"))return;e.preventDefault();const r=function(){try{const t=a("cart");return JSON.parse(localStorage.getItem(t)||"[]")}catch(t){return[]}}();if(!r.length)return void alert("Keranjang kosong");let o=0;const n=r.map((t=>(o+=Number(t.subtotal||0),{id:t.id,title:t.title,qty:t.qty,unitPrice:t.unitPrice,addons:t.addons||[],subtotal:t.subtotal}))),i={id:"ORD-"+(new Date).toISOString().slice(0,10)+"-"+Math.random().toString(36).slice(2,6),createdAt:Date.now(),status:"active",items:n,total:o},c=function(){try{const t=a("orders");return JSON.parse(localStorage.getItem(t)||"[]")}catch(t){return[]}}();c.unshift(i),function(t){const e=a("orders");localStorage.setItem(e,JSON.stringify(t||[]))}(c);const s="https://api.whatsapp.com/send?text="+encodeURIComponent(function(e){const r=[];return r.push(`ðŸ“¦ New Order â€” ${e.id}`),r.push(`Waktu: ${new Date(e.createdAt).toLocaleString("id-ID")}`),r.push(""),e.items.forEach((e=>{const a=(e.addons||[]).map((e=>`${e.label} (+${t(e.price)})`)).join(", ");r.push(`â€¢ ${e.title} x${e.qty} â€” ${t(e.unitPrice)} ${a?" | "+a:""} = ${t(e.subtotal)}`)})),r.push(""),r.push(`Total: ${t(e.total)}`),r.push(""),r.push("Nama:"),r.push("No. HP:"),r.push("Alamat / Catatan:"),r.push(""),r.push("Mohon konfirmasi ketersediaan & instruksi pembayaran via chat. Terima kasih!"),r.join("\n")}(i));window.open(s,"_blank"),window.location.href="order.html?order="+encodeURIComponent(i.id)}))}(),function(){const t=document.getElementById("share-btn"),e=document.getElementById("share-menu"),r=document.getElementById("share-toast"),a=document.getElementById("share-close");if(!t||!e)return;const o=window.location.href;function n(){e.style.display="none",e.setAttribute("aria-hidden","true")}function i(t="Link copied!"){r&&(r.textContent=t,r.hidden=!1,setTimeout((()=>r.hidden=!0),1600))}t.addEventListener("click",(t=>{t.stopPropagation(),e.style.display="block",e.setAttribute("aria-hidden","false")})),a?.addEventListener("click",n),e.addEventListener("click",(t=>{const e=t.target.getAttribute("data-action");e&&("copy"===e&&async function(){try{await navigator.clipboard.writeText(o),i("Link disalin ke clipboard")}catch(t){const e=document.createElement("textarea");e.value=o,document.body.appendChild(e),e.select();try{document.execCommand("copy"),i("Link disalin ke clipboard")}catch(t){alert("Copy failed. Link: "+o)}document.body.removeChild(e)}n()}(),"native"===e&&async function(){if(navigator.share)try{await navigator.share({title:document.title||"Check this product",text:"Lihat produk ini:",url:o})}catch(t){}else{const t="https://api.whatsapp.com/send?text="+encodeURIComponent(o);window.open(t,"_blank")}n()}())})),document.addEventListener("click",(r=>{e.contains(r.target)||r.target===t||n()}))}()}();