// @ts-nocheck
const ADMIN_EMAIL="byverent@gmail.com",ADMIN_PASSWORD="5Bisnis2021",supabase=window.supabase;document.querySelectorAll(".toggle").forEach((e=>{e.addEventListener("click",(()=>{const t=e.previousElementSibling;t&&(t.type="password"===t.type?"text":"password",e.textContent="password"===t.type?"ðŸ‘ï¸":"ðŸ™ˆ")}))}));const signInBtn=document.getElementById("signInBtn"),forgotLink=document.querySelector(".forgot-password-link");forgotLink&&forgotLink.addEventListener("click",(async e=>{e.preventDefault();const t=document.getElementById("email"),a=(t?.value||"").trim();if(a)try{const{error:e}=await supabase.auth.resetPasswordForEmail(a,{redirectTo:"https://matcah.netlify.app/reset-password.html"});if(e)return console.error("Reset password error:",e),void alert("Gagal mengirim email reset: "+e.message);alert("Link reset password sudah dikirim ke email.\nSilakan cek inbox atau folder spam, ya ðŸ˜Š")}catch(e){console.error("Unexpected reset error:",e),alert("Terjadi error saat mengirim reset password.")}else alert("Isi dulu email yang mau di-reset, ya ðŸ™‚")})),signInBtn&&signInBtn.addEventListener("click",(async()=>{const e=document.getElementById("email"),t=document.getElementById("password"),a=(e?.value||"").trim(),r=t?.value||"";if(a&&r){if(a.toLowerCase()===ADMIN_EMAIL.toLowerCase()&&"5Bisnis2021"===r){const e="Admin Verent";localStorage.setItem("maziRole","admin"),localStorage.setItem("maziEmail",ADMIN_EMAIL),localStorage.setItem("maziName",e),localStorage.setItem("maziPhone",""),localStorage.setItem("maziUID","admin-fixed");const t={firstName:"Admin",lastName:"Verent",email:ADMIN_EMAIL,phone:"",memberSince:(new Date).getFullYear()};return localStorage.setItem("profile",JSON.stringify(t)),void(window.location.href="frsadm.html")}try{const{data:e,error:t}=await supabase.auth.signInWithPassword({email:a,password:r});if(t)return console.error("Supabase login error:",t),void alert("Login error: "+t.message);const o=e.user;if(!o)return void alert("Login gagal. Coba lagi nanti ya.");const{data:s,error:i}=await supabase.from("profiles").select("*").eq("id",o.id).maybeSingle();i&&console.warn("Profile fetch error:",i);const n=s?.full_name||"",l=!0===s?.is_admin,m=n.split(/\s+/),c=m[0]||"",d=m.slice(1).join(" "),g=l?"admin":"user";localStorage.setItem("maziRole",g),localStorage.setItem("maziEmail",a),localStorage.setItem("maziName",n||a),localStorage.setItem("maziPhone",""),localStorage.setItem("maziUID",o.id);const u={firstName:c,lastName:d,email:a,phone:"",memberSince:(new Date).getFullYear()};localStorage.setItem("profile",JSON.stringify(u));try{"function"==typeof window.flushOrderQueue&&await window.flushOrderQueue()}catch(e){console.warn("flushOrderQueue throw",e)}const f=new URLSearchParams(window.location.search).get("from");if("bag"===f||"checkout"===f){try{const e=JSON.parse(localStorage.getItem("checkoutDraft_cart")||"null");e&&(localStorage.setItem("cart",JSON.stringify(e)),localStorage.removeItem("checkoutDraft_cart"))}catch(e){console.warn("failed restore draft",e)}return void(window.location.href="bag"===f?"bagfr.html":"cekout.html")}window.location.href="admin"===g?"frsadm.html":"Home.html"}catch(e){console.error("Unexpected login error:",e),alert("Terjadi error saat login. Coba lagi nanti ya.")}}else alert("Isi email dan password dulu ya ðŸ™‚")}));