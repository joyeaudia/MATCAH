// @ts-nocheck
!function(){"use strict";function e(e){try{return JSON.parse(localStorage.getItem(e)||"[]")}catch(e){return[]}}function t(){return"orders_"+(localStorage.getItem("maziUID")||"guest")}function n(){const n=e(t()),i=e("orders");if(Array.isArray(i)&&i.length){const e=new Set(n.map((e=>String(e.id))));i.forEach((t=>{if(!t)return;const i=String(t.id||"");e.has(i)||(e.add(i),n.push(t))}))}return n}function i(e){return"Rp "+new Intl.NumberFormat("id-ID").format(Number(e||0))}function d(e){return String(e||"").replace(/[&<>"']/g,(e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[e])))}function a(e,t,n){const i=document.getElementById(e);i&&(i.textContent=t||"",i.classList.remove("done","upcoming","not"),n&&("done"===n?i.classList.add("done"):"upcoming"===n?i.classList.add("upcoming"):i.classList.add("not")))}function r(e){const i=document.getElementById("detail-cancel-btn");if(!i)return;const d=(e.paymentStatus||"pending").toLowerCase(),a=(e.status||"").toLowerCase();"paid"===d||("rejected"===d||"cancelled"===a)||"delivered"===a?i.style.display="none":i.addEventListener("click",(function(){if(!confirm("Yakin ingin membatalkan order ini?"))return;const i=n()||[],d=i.findIndex((t=>String(t.id)===String(e.id)));var a;-1!==d&&(i[d].status="cancelled",i[d].paymentStatus="rejected",a=i,localStorage.setItem(t(),JSON.stringify(a||[]))),alert("Order telah dibatalkan. Status: cancelled"),window.location.href="order.html"}))}document.addEventListener("DOMContentLoaded",(function(){const e=new URLSearchParams(window.location.search).get("id"),t=(n()||[]).find((t=>String(t.id)===String(e)));if(!t)return alert("Order tidak ditemukan."),void(window.location.href="order.html");!function(e){const t=document.getElementById("detail-status-pill"),n=document.getElementById("detail-order-id"),i=document.getElementById("detail-order-date"),d=document.getElementById("detail-scheduled"),a=document.getElementById("detail-payment-method");if(n&&(n.textContent=e.id||"-"),i){const t=e.createdAt?new Date(e.createdAt):new Date;i.textContent=t.toLocaleString()}if(d)if(e.scheduledDelivery)try{const t=new Date(e.scheduledDelivery);d.textContent=isNaN(t.getTime())?e.scheduledDelivery:t.toLocaleDateString()}catch(t){d.textContent=e.scheduledDelivery}else if(e.scheduledAt){const t=new Date(e.scheduledAt);d.textContent=t.toLocaleString()}else d.textContent="-";if(a&&(a.textContent=e.paymentMethod||"QRIS"),t){const n=(e.status||"active").toLowerCase();let i="Active";"scheduled"===n?i="Scheduled":"delivered"===n?i="Delivered":"cancelled"===n&&(i="Cancelled"),t.textContent=i,t.classList.remove("shipped"),t.style.background="delivered"===n?"#10b981":"cancelled"===n?"#ef4444":"#0B84FF"}}(t),function(e){const t=document.getElementById("detail-items");t&&(t.innerHTML="",(e.items||[]).forEach((e=>{const n=document.createElement("div");n.className="product";const a=e.image?`\n          <div class="thumb">\n            <img src="${d(e.image)}"\n                 alt="${d(e.title||"")}"\n                 style="width:100%;height:100%;object-fit:cover;border-radius:16px;">\n          </div>\n        `:'<div class="thumb"></div>';n.innerHTML=`\n        ${a}\n        <div class="pinfo">\n          <div class="pname" style="font-size:13px;line-height:1.3;">\n            ${d(e.title||"")}\n          </div>\n          <div class="psub" style="font-size:11px;color:#888;">\n            ${d(e.brand||"")}\n          </div>\n          <div class="price" style="font-size:13px;margin-top:4px;">\n            ${i(e.unitPrice||e.subtotal||0)}\n          </div>\n        </div>\n        <div class="qty">${e.qty||1}</div>\n      `,t.appendChild(n)})))}(t),function(e){const t=document.getElementById("detail-summary");if(!t)return;const n=(e.items||[]).reduce(((e,t)=>{const n=Number(t.qty||1),i=null!=t.unitPrice?Number(t.unitPrice):Number(t.subtotal||0);if(!isNaN(n)&&!isNaN(i)){const d=null!=t.subtotal?Number(t.subtotal):n*i;return e+(isNaN(d)?0:d)}return e}),0),d=isNaN(Number(e.shippingFee))?0:Number(e.shippingFee),a=n+d;t.innerHTML=`\n      <div class="summary-row">\n        <div class="left">Product Subtotal</div>\n        <div class="right">${i(n)}</div>\n      </div>\n      <div class="summary-row">\n        <div class="left">Shipping Fee</div>\n        <div class="right">${i(d)}</div>\n      </div>\n      <div class="summary-row total">\n        <div class="left">Order Total</div>\n        <div class="right">${i(a)}</div>\n      </div>\n    `}(t),function(e){const t=e.tracking||{},n=(e.status||"").toLowerCase(),i=(e.paymentStatus||"").toLowerCase(),d=null==t.placed||!!t.placed,r=null!=t.paymentConfirmed?!!t.paymentConfirmed:"paid"===i,o=!!t.waitingForSchedule,c=!!t.preparingOrder,l=t.outForDelivery||{},s=!!l.active,u=l.info||"",m=!!t.delivered||"delivered"===n;a("track-placed",d?"Completed":"",d?"done":""),r?a("track-payment","Completed","done"):a("track-payment","Pending","not"),a("track-wait",o?"Completed":"",o?"done":""),a("track-prep",c?"Completed":"",c?"done":"");let v="",g="";(s||u)&&(v=u||"On the way",g="done"),a("track-out",v,g),a("track-delivered",m?"Completed":"",m?"done":"")}(t),r(t),document.getElementById("back-btn")?.addEventListener("click",(function(){const e=localStorage.getItem("lastOrderTab")||"active";window.location.href=`order.html?tab=${e}`}))}))}();