// @ts-nocheck
!function(){const e=(localStorage.getItem("maziEmail")||"").toLowerCase();if(!e)return void(window.location.href="singin.html");const t="savedAddresses_v1_"+e,a="savedAddresses_v1",n=document.getElementById("address-list"),d=document.getElementById("done-btn"),r=document.querySelector(".add-new");let s=!1;const l="checkout"===new URLSearchParams(window.location.search).get("from"),i=[];function c(e){try{return JSON.parse(e||"[]")}catch{return[]}}function o(){let e=c(localStorage.getItem(t));if(Array.isArray(e)&&e.length>0)return e;const n=c(localStorage.getItem(a));return Array.isArray(n)&&n.length>0?(localStorage.setItem(t,JSON.stringify(n)),localStorage.removeItem(a),n):i.slice()}function u(e){localStorage.setItem(t,JSON.stringify(e||[]))}function m(e){return String(e||"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function f(){const e=o();var t;n.innerHTML="",t=e.length,r&&(s=t>=5,s?(r.classList.add("disabled"),r.setAttribute("aria-disabled","true")):(r.classList.remove("disabled"),r.removeAttribute("aria-disabled"))),e.length?(e.forEach(((e,t)=>{const a=document.createElement("div");a.className="address-card",a.innerHTML=`\n        <button class="addr-delete" data-idx="${t}" aria-label="Delete address">âœ•</button>\n\n        <div class="address-label">${m(e.label||"")}</div>\n        <input class="address-radio" type="radio" name="addrSelect"\n               data-idx="${t}" ${e.isDefault?"checked":""}\n               aria-label="Select ${m(e.label||"address")}">\n\n        <div class="addr-name">${m(e.name||"")}</div>\n        <div class="addr-phone">${m(e.phone||"")}</div>\n        <div class="address-divider"></div>\n        <div class="addr-full">\n          ${m(e.address||"").replace(/\n/g,"<br>")}\n        </div>\n      `,n.appendChild(a)})),n.querySelectorAll(".address-radio").forEach((e=>{e.addEventListener("change",(function(){const e=Number(this.dataset.idx),t=o();t.forEach(((t,a)=>t.isDefault=a===e)),u(t)}))})),n.querySelectorAll(".addr-delete").forEach((e=>{e.addEventListener("click",(function(){const e=Number(this.dataset.idx);confirm("Hapus alamat ini?")&&function(e){const t=o();e<0||e>=t.length||(t.splice(e,1),t.length&&(t.some((e=>e&&e.isDefault))||(t[0].isDefault=!0)),u(t),f())}(e)}))}))):n.innerHTML='<div class="empty">Belum ada alamat tersimpan. Tap "Add New Address".</div>'}r&&r.addEventListener("click",(function(e){s&&(e.preventDefault(),alert("Maksimal 5 alamat. Hapus salah satu dulu ya ðŸ˜Š"))})),d.addEventListener("click",(function(){const e=o();if(!e.length)return void(window.location.href=l?"cekout.html":"prl.html");const t=e.find((e=>e&&e.isDefault))||e[0];if(l&&t){const e=(t.name||"")+"\n"+(t.phone||"")+"\n"+(t.address||"");try{localStorage.setItem("checkoutRecipientDraft_v1",e)}catch(e){console.warn("Failed to save checkoutRecipientDraft_v1",e)}window.location.href="cekout.html"}else window.location.href="prl.html"})),document.addEventListener("DOMContentLoaded",f)}();